<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>System</title>

<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#6dd5fa,#2980b9);
  color: #fff;
}

nav {
  display: flex;
  gap: 15px;
  padding: 15px;
  background: rgba(0,0,0,0.25);
  align-items: center;
}

nav button {
  background: #fff;
  color: #333;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

nav button.locked {
  opacity: 0.4;
  pointer-events: none;
}

.coins {
  margin-left: auto;
  font-weight: bold;
}

section {
  display: none;
  padding: 30px;
  animation: fade 0.4s ease;
}

section.active {
  display: block;
}

input {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
  border: none;
}

button.main {
  width: 100%;
  padding: 12px;
  background: #27ae60;
  border: none;
  border-radius: 8px;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
}

.game-btn {
  padding: 10px;
  margin: 5px;
  background: #f1c40f;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

@keyframes fade {
  from {opacity:0; transform:translateY(10px);}
  to {opacity:1; transform:translateY(0);}
}

.loading {
  display:none;
  margin-top:15px;
}
.loading span {
  animation: blink 1.2s infinite;
}
@keyframes blink {
  0%{opacity:0.2;}
  50%{opacity:1;}
  100%{opacity:0.2;}
}
</style>
</head>

<body>

<nav>
  <button onclick="show('main')">Main</button>
  <button id="gameTab" class="locked" onclick="show('games')">Games</button>
  <button id="redeemTab" class="locked" onclick="show('redeem')">Redeem</button>
  <div class="coins">Coins: <span id="coins">0</span></div>
</nav>

<!-- MAIN -->
<section id="main" class="active">
  <h2>COMMENT FIRST TO START</h2>
  <input id="c1" placeholder="Comment 1">
  <input id="c2" placeholder="Comment 2">
  <button class="main" onclick="submitComment()">SUBMIT</button>
</section>

<!-- GAMES -->
<section id="games">
  <h2>GAMES</h2>
  <p>Win: <span id="win">0</span> | Lose: <span id="lose">0</span></p>
  <h3 id="question">Select a game</h3>
  <input id="answer" placeholder="Answer">
  <button class="main" onclick="check()">SUBMIT ANSWER</button><br><br>

  <button class="game-btn" onclick="start('+')">+</button>
  <button class="game-btn" onclick="start('-')">-</button>
  <button class="game-btn" onclick="start('*')">×</button>
  <button class="game-btn" onclick="start('/')">÷</button>
</section>

<!-- REDEEM -->
<section id="redeem">
  <h2>ENTER COINS TO REDEEM</h2>
  <input id="redeemCoins" placeholder="Coins (ex: 100 = 10)">
  <p>= <span id="redeemValue">0</span></p>
  <input id="f1" placeholder="Feedback 1">
  <input id="f2" placeholder="Feedback 2">
  <button class="main" onclick="redeem()">REDEEM</button>

  <div class="loading" id="loading">
    Processing <span>• • • • •</span>
  </div>
</section>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzsnL9EU__8b4Vwh1iilsd9GCGYswGT5mHSFlNAAky3kh-4XzKWDZO-cFpoVK95SoBX/exec";

let unlocked = false;
let coins = 0, win = 0, lose = 0;
let correctAnswer = 0;

function show(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function submitComment(){
  fetch(WEBAPP_URL,{
    method:"POST",
    body:JSON.stringify({
      type:"comment",
      comment1:c1.value,
      comment2:c2.value
    })
  });

  unlocked = true;
  gameTab.classList.remove("locked");
  redeemTab.classList.remove("locked");
  alert("Unlocked! You can now play.");
}

function start(op){
  let a = Math.floor(Math.random()*20)+1;
  let b = Math.floor(Math.random()*10)+1;

  if(op==="/"){
    correctAnswer = a;
    question.innerText = (a*b)+" ÷ "+b;
  } else {
    correctAnswer = eval(a+op+b);
    question.innerText = a+" "+op+" "+b;
  }
}

function check(){
  if(Number(answer.value) === correctAnswer){
    coins += 45;
    win++;
  } else {
    coins -= 5;
    lose++;
  }
  update();
  answer.value="";
}

function update(){
  document.getElementById("coins").innerText = coins;
  win.innerText = win;
  lose.innerText = lose;
}

redeemCoins.oninput = ()=>{
  redeemValue.innerText = redeemCoins.value/10 || 0;
}

function redeem(){
  loading.style.display="block";

  setTimeout(()=>{
    loading.style.display="none";

    fetch(WEBAPP_URL,{
      method:"POST",
      body:JSON.stringify({
        type:"feedback",
        feedback1:f1.value,
        feedback2:f2.value,
        redeemCoins:redeemCoins.value
      })
    });

    alert("Redeem successfully! Wait 24hrs.");
  },11000);
}
</script>

</body>
</html>
