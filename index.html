<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Math Game Redeem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0;padding:0;height:100%;font-family:monospace;background:#111;color:#0f0;overflow:hidden;}
body{display:flex;flex-direction:column;}
.topbar{display:flex;justify-content:space-around;background:#000;padding:10px;position:sticky;top:0;z-index:100;}
.topbar button{background:#111;color:#0f0;border:2px solid #0f0;padding:8px 12px;font-size:16px;cursor:pointer;}
.topbar button:disabled{opacity:0.3;cursor:default;}
.center{display:flex;flex-direction:column;align-items:center;justify-content:center;height:calc(100vh - 50px);text-align:center;}
.hidden{display:none;}
input,button{padding:8px;margin:5px;background:#111;color:#0f0;border:2px solid #0f0;font-size:16px;}
button:hover:not(:disabled){background:#0f0;color:#000;}
.glow{animation:glow 1s alternate infinite;text-shadow:0 0 10px #0f0,0 0 30px #0f0;}
@keyframes glow{from{opacity:.6} to{opacity:1}}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <button id="btnMain" onclick="showPage('mainPage')">Main</button>
  <button id="btnGame" onclick="showPage('gamePage')" disabled>Game</button>
  <button id="btnRedeem" onclick="showPage('redeemPage')" disabled>Redeem</button>
  <span>COINS: <span id="coinsCounter">0</span></span>
</div>

<!-- MAIN -->
<div id="mainPage" class="center">
  <h1 class="glow">WELCOME</h1>
  <div id="commentSection">
    <h2>Submit Comment to Unlock Game & Redeem</h2>
    <input id="c1" placeholder="Comment 1">
    <input id="c2" placeholder="Comment 2">
    <button onclick="submitComment()">Submit</button>
  </div>
</div>

<!-- GAME -->
<div id="gamePage" class="center hidden">
  <h2 id="question"></h2>
  <input id="answer" placeholder="Your Answer">
  <button onclick="submitAnswer()">Submit</button>
  <button onclick="showPage('mainPage')">Back</button>
</div>

<!-- REDEEM -->
<div id="redeemPage" class="center hidden">
  <h3>Redeem Options</h3>
  <button onclick="redeem(600,60)">600 → 60</button>
  <button onclick="redeem(1000,100)">1000 → 100</button>
  <button onclick="redeem(2000,200)">2000 → 200</button>
  <button onclick="redeem(50000,5000)">50000 → 5000</button>

  <div id="feedbackRedeem" class="hidden">
    <h3>Feedback for Redeem</h3>
    <input id="f1" placeholder="Feedback1">
    <input id="f2" placeholder="Feedback2">
    <button onclick="submitFeedback()">Submit</button>
  </div>

  <div id="redeemSuccess" class="hidden">
    <h2>REDEEM SUCCESSFULLY ✅</h2>
  </div>

  <button onclick="showPage('mainPage')">Back</button>
</div>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbwbgXlhCkMZ4x5I43qqcbOIOA-pegFs1Uxu5q1dGz737_yZMa4zcfa4S7IQsE4QTRU/exec"; // ilisi sa imo Web App URL
let registered=false;
let coins=0;
let currentAnswer=0;

/* ===== Page Switch ===== */
function showPage(id){
  document.querySelectorAll('.center').forEach(d=>d.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.getElementById('coinsCounter').textContent = coins;
}

/* ===== Submit Comment ===== */
async function submitComment(){
  const c1=document.getElementById('c1').value;
  const c2=document.getElementById('c2').value;
  if(!c1||!c2){alert("Fill both fields"); return;}

  try{
    await fetch(webAppUrl,{method:'POST',body:JSON.stringify({type:'comment',field1:c1,field2:c2})});
  }catch(e){console.log(e);}

  registered=true;
  document.getElementById('btnGame').disabled=false;
  document.getElementById('btnRedeem').disabled=false;
  showPage('mainPage');
}

/* ===== GAME LOGIC ===== */
function generateQuestion(){
  const type=Math.floor(Math.random()*4);
  let q='',ans=0;
  switch(type){
    case 0:
      const a1=Math.floor(Math.random()*90)+10;
      const a2=Math.floor(Math.random()*90)+10;
      q=`${a1} + ${a2}`; ans=a1+a2; break;
    case 1:
      const b1=Math.floor(Math.random()*900)+100;
      const b2=Math.floor(Math.random()*900)+100;
      q=`${b1} - ${b2}`; ans=b1-b2; break;
    case 2:
      const c1=Math.floor(Math.random()*90)+10;
      const c2=Math.floor(Math.random()*90)+10;
      q=`${c1} × ${c2}`; ans=c1*c2; break;
    case 3:
      const d1=Math.floor(Math.random()*900)+100;
      q=`${d1} ÷ 1`; ans=d1; break;
  }
  currentAnswer=ans;
  document.getElementById('question').textContent=q;
  document.getElementById('answer').value='';
}

function submitAnswer(){
  const user=parseInt(document.getElementById('answer').value);
  if(user===currentAnswer) coins+=40; else coins-=3;
  document.getElementById('coinsCounter').textContent=coins;
  generateQuestion();
}

/* ===== REDEEM ===== */
function redeem(req,val){
  if(coins<req){alert("Not enough coins"); return;}
  coins-=req;
  document.getElementById('coinsCounter').textContent=coins;
  document.getElementById('feedbackRedeem').classList.remove('hidden');
}

async function submitFeedback(){
  const f1=document.getElementById('f1').value;
  const f2=document.getElementById('f2').value;
  if(!f1||!f2){alert("Fill both fields"); return;}

  try{
    await fetch(webAppUrl,{method:'POST',body:JSON.stringify({type:'feedback',field1:f1,field2:f2})});
  }catch(e){console.log(e);}

  document.getElementById('feedbackRedeem').classList.add('hidden');
  document.getElementById('redeemSuccess').classList.remove('hidden');
}

generateQuestion();
</script>

</body>
</html>
