<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fun Games & Redeem</title>

<style>
/* ---------- GLOBAL ---------- */
body, html{
  margin:0; padding:0; font-family: 'Segoe UI', sans-serif;
  background:#1e1e2f; color:#fff;
  height:100%; overflow-x:hidden;
}
button,input{
  padding:10px 15px; font-size:16px; border:none;
  border-radius:5px; margin:5px;
}
input{width:150px;}

/* ---------- SIDEBAR ---------- */
#sidebar{
  display:flex; justify-content:center; align-items:center;
  background:#0a0a1e; padding:10px;
  gap:10px; position:fixed; top:0; width:100%; z-index:10;
}
#sidebar button{
  background:none; border:2px solid #0f0; color:#0f0;
  cursor:pointer;
}
#sidebar button.active{
  background:#0f0; color:#000;
}

/* ---------- CONTAINER ---------- */
.container{
  padding:80px 20px 20px 20px;
  text-align:center;
}
h1{color:#0f0; margin-bottom:20px;}

/* ---------- LOADING ---------- */
#loading{
  font-size:20px; color:#0f0; text-shadow:0 0 10px #0f0;
  margin-top:50px;
}

/* ---------- GAME ---------- */
#coinsDisplay{
  font-size:18px; margin-bottom:20px; color:#ffd700;
}

/* ---------- REDEEM ---------- */
#redeemOptions button{
  background:#0f0; color:#000;
}
#redeemLoading{
  margin-top:10px; color:#0f0;
}
#redeemSuccess{
  color:#0f0; font-weight:bold; margin-top:10px;
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <button id="mainBtn" class="active">MAIN</button>
  <button id="gameBtn">GAME</button>
  <button id="redeemBtn">REDEEM</button>
</div>

<div class="container">

  <!-- MAIN -->
  <div id="mainPage">
    <h1>Welcome! Submit Comment to Unlock</h1>
    <input id="c1" placeholder="Comment1">
    <input id="c2" placeholder="Comment2">
    <button onclick="submitComment()">SUBMIT</button>
    <p id="mainStatus" style="color:#0f0; margin-top:10px;"></p>
  </div>

  <!-- GAME -->
  <div id="gamePage" style="display:none;">
    <h1>Math Game</h1>
    <div id="coinsDisplay">COINS: 0</div>
    <div id="gameQuestion"></div>
    <input id="gameAnswer" type="number" placeholder="Answer">
    <button onclick="checkAnswer()">Submit Answer</button>
    <p id="gameFeedback"></p>
  </div>

  <!-- REDEEM -->
  <div id="redeemPage" style="display:none;">
    <h1>Redeem Coins</h1>
    <div id="redeemCoins">COINS: 0</div>
    <div id="redeemOptions">
      <button onclick="redeem(600,60)">600 coins → 60</button>
      <button onclick="redeem(1000,100)">1000 coins → 100</button>
      <button onclick="redeem(2000,200)">2000 coins → 200</button>
      <button onclick="redeem(50000,5000)">50000 coins → 5000</button>
    </div>
    <div id="redeemLoading"></div>
    <div id="redeemSuccess"></div>
  </div>

</div>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbwbgXlhCkMZ4x5I43qqcbOIOA-pegFs1Uxu5q1dGz737_yZMa4zcfa4S7IQsE4QTRU/exec";

/* ---------- SIDEBAR NAV ---------- */
const mainBtn = document.getElementById('mainBtn');
const gameBtn = document.getElementById('gameBtn');
const redeemBtn = document.getElementById('redeemBtn');

const mainPage = document.getElementById('mainPage');
const gamePage = document.getElementById('gamePage');
const redeemPage = document.getElementById('redeemPage');

function showPage(page){
  mainPage.style.display="none";
  gamePage.style.display="none";
  redeemPage.style.display="none";
  mainBtn.classList.remove("active");
  gameBtn.classList.remove("active");
  redeemBtn.classList.remove("active");
  
  page.style.display="block";
}
mainBtn.onclick=()=>{ showPage(mainPage); mainBtn.classList.add("active"); }
gameBtn.onclick=()=>{ if(canPlay){ showPage(gamePage); gameBtn.classList.add("active"); } }
redeemBtn.onclick=()=>{ if(canPlay){ showPage(redeemPage); redeemBtn.classList.add("active"); } }

/* ---------- UNLOCK LOGIC ---------- */
let canPlay = false;
let coins = 0;
let currentAnswer = 0;

function submitComment(){
  const c1=document.getElementById('c1').value;
  const c2=document.getElementById('c2').value;
  if(!c1||!c2){ alert("Fill both fields!"); return; }

  fetch(webAppUrl,{
    method:"POST",
    body:JSON.stringify({type:"comment",field1:c1,field2:c2})
  }).then(r=>r.json()).then(res=>{
    if(res.status==="success"){
      document.getElementById('mainStatus').textContent="Comment submitted! Game & Redeem unlocked!";
      canPlay = true;
      coins=0;
      updateCoins();
    }else{
      alert("Error submitting!");
    }
  });
}

/* ---------- GAME LOGIC ---------- */
function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

function generateQuestion(){
  const ops = ['+','-','*','÷'];
  const op = ops[randomInt(0,ops.length-1)];
  let a,b,ans;
  switch(op){
    case '+': a=randomInt(10,99); b=randomInt(10,99); ans=a+b; break;
    case '-': a=randomInt(100,999); b=randomInt(10,99); ans=a-b; break;
    case '*': a=randomInt(10,99); b=randomInt(10,99); ans=a*b; break;
    case '÷': a=randomInt(10,999); b=randomInt(1,9); ans=Math.floor(a/b); a=ans*b; break; // no decimals
  }
  currentAnswer = ans;
  document.getElementById('gameQuestion').textContent=`${a} ${op} ${b} = ?`;
}
function checkAnswer(){
  const ans = parseInt(document.getElementById('gameAnswer').value);
  const fb = document.getElementById('gameFeedback');
  if(ans===currentAnswer){ coins+=40; fb.textContent="Correct +40 coins!"; }
  else{ coins-=3; fb.textContent=`Wrong -3 coins! Answer was ${currentAnswer}`; }
  updateCoins();
  document.getElementById('gameAnswer').value="";
  generateQuestion();
}
function updateCoins(){
  document.getElementById('coinsDisplay').textContent=`COINS: ${coins}`;
  document.getElementById('redeemCoins').textContent=`COINS: ${coins}`;
}

/* ---------- REDEEM LOGIC ---------- */
function redeem(cost,value){
  if(coins<cost){ alert("Not enough coins!"); return; }
  coins -= cost; updateCoins();
  document.getElementById('redeemLoading').textContent="Submitting...";
  fetch(webAppUrl,{
    method:"POST",
    body:JSON.stringify({type:"redeem",field1:cost,field2:value})
  }).then(r=>r.json()).then(res=>{
    if(res.status==="success"){
      document.getElementById('redeemLoading').textContent="";
      document.getElementById('redeemSuccess').textContent=`Successfully Redeemed ${value}!`;
    }else{ alert("Error redeeming"); }
  });
}

/* ---------- INIT ---------- */
generateQuestion();
</script>

</body>
</html>
